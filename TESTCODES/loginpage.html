<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Is It Normal? Student Health Bot</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700&display=swap');

        body {
            font-family: 'Nunito', sans-serif;
            background-color: #F8FAFC; /* Slate-50 - Cool neutral background */
            color: #334155; /* Slate-700 */
        }

        /* Chart Container Styling per requirements */
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
            height: 300px;
            max-height: 400px;
        }

        @media (min-width: 768px) {
            .chart-container {
                height: 350px;
            }
        }

        /* Custom Scrollbar for chat */
        .chat-scroll::-webkit-scrollbar {
            width: 6px;
        }
        .chat-scroll::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        .chat-scroll::-webkit-scrollbar-thumb {
            background: #94A3B8; /* Slate-400 */
            border-radius: 3px;
        }

        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .slide-in-right {
            animation: slideInRight 0.4s ease-out;
        }

        @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        /* Interactive Elements - THEME UPDATE: BLUE */
        .btn-primary {
            background-color: #2563EB; /* Blue-600 */
            color: white;
            transition: all 0.3s ease;
        }
        .btn-primary:hover {
            background-color: #1D4ED8; /* Blue-700 */
            transform: translateY(-1px);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        .input-focus:focus {
            outline: none;
            border-color: #2563EB; /* Blue-600 */
            ring: 2px;
            ring-color: #BFDBFE; /* Blue-200 */
        }
        
        .tab-active {
            border-bottom: 3px solid #2563EB; /* Blue-600 */
            color: #1E293B; /* Slate-800 */
            font-weight: 700;
        }
        .tab-inactive {
            border-bottom: 3px solid transparent;
            color: #64748B; /* Slate-500 */
        }
        .tab-inactive:hover {
            color: #2563EB; /* Blue-600 */
        }
    </style>
    <!-- Chosen Palette: Cool Blues & White (#F8FAFC Background, #2563EB Primary) -->
    <!-- Application Structure Plan: Central "Stage" container. 
         1. Auth/Landing Stage: Tabs for Login and Register (w/ OTP flow). About tab removed.
         2. Dashboard Stage: Accessible only after login. Features a sidebar navigation and main content area with "Chat Bot" and "Health Insights".
         Modifications: Color theme updated to Blue. Medical history organized vertically. DOB and Region added. -->
    <!-- Visualization & Content Choices:
         1. Form: Real-time validation, Age sync, Vertical layout for medical history.
         2. Dashboard Charts: 
            - "Teen Health Commonality" (Bar Chart): Updated to Blue palette.
            - "Wellness Balance" (Radar Chart): Updated to Blue palette.
         3. Chat Interface: Blue accents for user bubbles and bot identity. -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
</head>
<body class="min-h-screen flex flex-col">

    <!-- Navbar -->
    <nav class="bg-white shadow-sm border-b border-gray-100 z-10 relative">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center">
                    <span class="text-3xl mr-2">ü©∫</span>
                    <div>
                        <h1 class="text-xl font-bold text-gray-800 tracking-tight">Is It Normal?</h1>
                        <p class="text-xs text-blue-600 font-semibold">Student Health Bot</p>
                    </div>
                </div>
                <div class="flex items-center" id="nav-user-info" style="display: none;">
                    <span class="text-gray-600 mr-2 text-sm hidden sm:block">Welcome, <span id="nav-username" class="font-bold">Student</span></span>
                    <button onclick="logout()" class="text-sm text-red-500 hover:text-red-700 font-medium">Logout</button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content Stage -->
    <main class="flex-grow flex items-center justify-center p-4 relative overflow-hidden">
        
        <!-- Decorative Background Elements (CSS Shapes) - Updated Colors -->
        <div class="absolute top-10 left-10 w-32 h-32 bg-blue-100 rounded-full mix-blend-multiply filter blur-xl opacity-70 animate-blob"></div>
        <div class="absolute top-10 right-10 w-32 h-32 bg-cyan-100 rounded-full mix-blend-multiply filter blur-xl opacity-70 animate-blob animation-delay-2000"></div>
        <div class="absolute -bottom-8 left-20 w-32 h-32 bg-indigo-100 rounded-full mix-blend-multiply filter blur-xl opacity-70 animate-blob animation-delay-4000"></div>

        <!-- STAGE 1: AUTHENTICATION CONTAINER -->
        <div id="auth-container" class="bg-white w-full max-w-md rounded-2xl shadow-xl overflow-hidden border border-gray-100 fade-in z-10">
            
            <!-- Auth Header/Tabs -->
            <div class="flex border-b border-gray-100">
                <button onclick="switchTab('login')" id="tab-login" class="flex-1 py-4 text-center font-medium transition-colors tab-active">
                    Login
                </button>
                <button onclick="switchTab('register')" id="tab-register" class="flex-1 py-4 text-center font-medium transition-colors tab-inactive">
                    Register
                </button>
            </div>

            <div class="p-6 sm:p-8 min-h-[500px] flex flex-col">
                
                <!-- VIEW: LOGIN -->
                <div id="view-login" class="flex-grow flex flex-col justify-center space-y-6">
                    <div class="text-center mb-4">
                        <h2 class="text-2xl font-bold text-gray-800">Welcome Back! üéì</h2>
                        <p class="text-gray-500 text-sm mt-1">Login to access your personalized health dashboard.</p>
                    </div>

                    <form onsubmit="handleLogin(event)" class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Email Address</label>
                            <input type="email" id="login-email" required class="w-full px-4 py-3 rounded-lg border border-gray-300 input-focus transition-colors" placeholder="student@example.com">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Password</label>
                            <input type="password" id="login-password" required class="w-full px-4 py-3 rounded-lg border border-gray-300 input-focus transition-colors" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                            <div class="flex justify-between items-center mt-2">
                                <label class="flex items-center text-sm text-gray-600">
                                    <input type="checkbox" class="mr-2 rounded text-blue-600 focus:ring-blue-500"> Remember me
                                </label>
                                <a href="#" class="text-sm text-blue-600 hover:underline">Forgot?</a>
                            </div>
                        </div>
                        <button type="submit" class="w-full btn-primary py-3 rounded-lg font-bold shadow-md">
                            LOGIN
                        </button>
                    </form>
                    
                    <div class="mt-auto pt-6 text-center text-xs text-gray-400">
                        <p>üîí Your health data is confidential.</p>
                    </div>
                </div>

                <!-- VIEW: REGISTER (Step 1: Details) -->
                <div id="view-register" class="hidden flex-grow flex flex-col space-y-4">
                    <div class="text-center">
                        <h2 class="text-xl font-bold text-gray-800">Create Account</h2>
                        <p class="text-xs text-gray-500">Step 1 of 2: Your Details</p>
                        <div class="w-full bg-gray-200 h-1.5 rounded-full mt-2">
                            <div class="bg-blue-600 h-1.5 rounded-full" style="width: 50%"></div>
                        </div>
                    </div>

                    <form onsubmit="initiateOtp(event)" class="space-y-3 overflow-y-auto max-h-[400px] pr-2 chat-scroll">
                        <!-- Full Name -->
                        <div>
                            <label class="block text-xs font-bold text-gray-700 uppercase tracking-wide">Full Name *</label>
                            <input type="text" id="reg-name" required class="w-full px-3 py-2 rounded border border-gray-300 input-focus" placeholder="Ananya Sharma" oninput="validateField(this)">
                            <p class="text-xs text-blue-600 mt-1 hidden" id="name-feedback">Name looks good ‚úì</p>
                        </div>

                         <!-- Date of Birth & Region Row -->
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-xs font-bold text-gray-700 uppercase tracking-wide">Date of Birth *</label>
                                <input type="date" id="reg-dob" required class="w-full px-3 py-2 rounded border border-gray-300 input-focus text-sm" onchange="calculateAgeFromDOB(this.value)">
                            </div>
                            <div>
                                <label class="block text-xs font-bold text-gray-700 uppercase tracking-wide">Region *</label>
                                <select id="reg-region" required class="w-full px-3 py-2 rounded border border-gray-300 input-focus bg-white text-sm">
                                    <option value="">Select Region...</option>
                                    <option value="North India">North India</option>
                                    <option value="South India">South India</option>
                                    <option value="East India">East India</option>
                                    <option value="West India">West India</option>
                                    <option value="Central India">Central India</option>
                                    <option value="Other">Other</option>
                                </select>
                            </div>
                        </div>

                        <!-- Age Slider -->
                        <div>
                            <label class="block text-xs font-bold text-gray-700 uppercase tracking-wide">Age * <span id="age-display" class="bg-gray-100 px-2 py-0.5 rounded text-gray-800 ml-2">16</span></label>
                            <div class="flex items-center space-x-3 mt-1">
                                <span class="text-xs text-gray-500">10</span>
                                <input type="range" id="reg-age-slider" min="10" max="25" value="16" class="flex-grow h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-blue-600" oninput="syncAge(this.value)">
                                <span class="text-xs text-gray-500">25</span>
                            </div>
                            <input type="hidden" id="reg-age" value="16">
                            <p id="age-warning" class="text-xs text-orange-500 mt-1 font-medium">üì¢ You are under 18. Talk to a parent about concerns.</p>
                        </div>

                        <!-- Blood Group -->
                        <div>
                            <label class="block text-xs font-bold text-gray-700 uppercase tracking-wide">Blood Group *</label>
                            <select id="reg-blood" required class="w-full px-3 py-2 rounded border border-gray-300 input-focus bg-white">
                                <option value="">‚ñº Select Blood Group...</option>
                                <option value="A+">A+</option>
                                <option value="A-">A-</option>
                                <option value="B+">B+</option>
                                <option value="B-">B-</option>
                                <option value="O+">O+</option>
                                <option value="O-">O-</option>
                                <option value="AB+">AB+</option>
                                <option value="AB-">AB-</option>
                            </select>
                        </div>

                        <!-- Medical History Section (Vertical Stack) -->
                        <div class="bg-gray-50 p-4 rounded-lg border border-gray-200 space-y-4">
                            <h3 class="text-sm font-bold text-gray-800 border-b border-gray-200 pb-2">Detailed Medical History</h3>
                            
                            <!-- Chronic Diseases -->
                            <div>
                                <label class="block text-xs font-bold text-gray-600 uppercase mb-1">Chronic Diseases (if any)</label>
                                <input type="text" id="reg-chronic" class="w-full px-3 py-2 rounded border border-gray-300 text-sm focus:border-blue-500 focus:outline-none bg-white" placeholder="e.g. Diabetes, Asthma, None">
                            </div>

                            <!-- Allergies -->
                            <div>
                                <label class="block text-xs font-bold text-gray-600 uppercase mb-1">Allergies (Food or Drug)</label>
                                <input type="text" id="reg-allergies" class="w-full px-3 py-2 rounded border border-gray-300 text-sm focus:border-blue-500 focus:outline-none bg-white" placeholder="e.g. Peanuts, Penicillin, None">
                            </div>

                            <!-- Medications -->
                            <div>
                                <label class="block text-xs font-bold text-gray-600 uppercase mb-1">Current Medications</label>
                                <input type="text" id="reg-medications" class="w-full px-3 py-2 rounded border border-gray-300 text-sm focus:border-blue-500 focus:outline-none bg-white" placeholder="e.g. Insulin, Vitamins, None">
                            </div>

                            <!-- Accidents/Surgeries -->
                            <div>
                                <label class="block text-xs font-bold text-gray-600 uppercase mb-1">Major Accidents or Surgeries</label>
                                <input type="text" id="reg-surgeries" class="w-full px-3 py-2 rounded border border-gray-300 text-sm focus:border-blue-500 focus:outline-none bg-white" placeholder="e.g. Fracture (2021), None">
                            </div>
                        </div>

                        <!-- Email -->
                        <div>
                            <label class="block text-xs font-bold text-gray-700 uppercase tracking-wide">Email Address *</label>
                            <input type="email" id="reg-email" required class="w-full px-3 py-2 rounded border border-gray-300 input-focus" placeholder="student@example.com">
                        </div>

                        <!-- Terms -->
                        <div class="flex items-start">
                            <input type="checkbox" required class="mt-1 mr-2 rounded text-blue-600 focus:ring-blue-500">
                            <span class="text-xs text-gray-600">I agree to Terms & Privacy Policy. My health info is used only to personalize guidance.</span>
                        </div>

                        <button type="submit" class="w-full btn-primary py-3 rounded-lg font-bold shadow-md mt-2 flex justify-center items-center group">
                            CONTINUE TO VERIFICATION <span class="ml-2 group-hover:translate-x-1 transition-transform">‚Üí</span>
                        </button>
                    </form>
                </div>

                <!-- VIEW: OTP VERIFICATION -->
                <div id="view-otp" class="hidden flex-grow flex flex-col justify-center space-y-6 slide-in-right">
                    <div class="text-center">
                        <div class="mx-auto w-12 h-12 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center text-xl mb-4">‚úâÔ∏è</div>
                        <h2 class="text-xl font-bold text-gray-800">Verify Your Email</h2>
                        <p class="text-sm text-gray-500 mt-2">We sent a verification code to <br><span id="otp-email-display" class="font-bold text-gray-800">email@example.com</span></p>
                    </div>

                    <div class="space-y-4">
                        <label class="block text-xs font-bold text-gray-700 uppercase tracking-wide text-center">Enter 4-Digit Code</label>
                        <div class="flex justify-center space-x-3">
                            <input type="text" maxlength="1" class="w-12 h-12 text-center text-xl border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none otp-input" onkeyup="focusNext(this, 0)">
                            <input type="text" maxlength="1" class="w-12 h-12 text-center text-xl border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none otp-input" onkeyup="focusNext(this, 1)">
                            <input type="text" maxlength="1" class="w-12 h-12 text-center text-xl border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none otp-input" onkeyup="focusNext(this, 2)">
                            <input type="text" maxlength="1" class="w-12 h-12 text-center text-xl border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none otp-input" onkeyup="focusNext(this, 3)">
                        </div>
                        <p class="text-xs text-center text-gray-400">Code is valid for 10 minutes.</p>
                    </div>

                    <div class="space-y-3">
                        <button onclick="verifyOtp()" class="w-full btn-primary py-3 rounded-lg font-bold shadow-md">
                            VERIFY & CREATE ACCOUNT
                        </button>
                        <button onclick="switchTab('register')" class="w-full text-sm text-gray-500 hover:text-gray-800">
                            ‚Üê Back to Details
                        </button>
                    </div>
                </div>

                <!-- VIEW: SUCCESS & CREDENTIALS -->
                <div id="view-success" class="hidden flex-grow flex flex-col justify-center items-center space-y-6 slide-in-right text-center">
                    <div class="w-16 h-16 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center text-3xl animate-bounce">‚úì</div>
                    <div>
                        <h2 class="text-2xl font-bold text-gray-800">Registration Successful!</h2>
                        <p class="text-sm text-gray-500 mt-1">Your account has been created securely.</p>
                    </div>

                    <div class="bg-gray-50 p-4 rounded-xl border border-gray-200 w-full">
                        <p class="text-xs text-gray-500 mb-2 uppercase tracking-wide font-bold">Your Generated Password</p>
                        <div class="flex items-center justify-between bg-white border border-gray-300 rounded p-2">
                            <span id="generated-password" class="font-mono text-lg tracking-widest px-2">‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢</span>
                            <div class="flex space-x-2">
                                <button onclick="togglePasswordVisibility()" class="text-xs text-blue-600 font-semibold hover:underline">Show</button>
                                <button onclick="copyPassword()" class="text-xs text-gray-600 font-semibold hover:underline">Copy</button>
                            </div>
                        </div>
                        <p class="text-[10px] text-red-500 mt-2 text-left">‚ö†Ô∏è Save this securely. We also sent it to your email.</p>
                    </div>

                    <button onclick="completeRegistration()" class="w-full btn-primary py-3 rounded-lg font-bold shadow-md">
                        COMPLETE & GO TO LOGIN
                    </button>
                </div>

            </div>
        </div>

        <!-- STAGE 2: DASHBOARD (Hidden initially) -->
        <div id="dashboard-container" class="hidden w-full max-w-6xl bg-white rounded-2xl shadow-xl overflow-hidden border border-gray-100 flex flex-col md:flex-row h-[85vh]">
            
            <!-- Dashboard Sidebar -->
            <aside class="w-full md:w-64 bg-gray-50 border-r border-gray-200 flex flex-col">
                <div class="p-6 border-b border-gray-200">
                    <div class="flex items-center space-x-3">
                        <div class="w-10 h-10 rounded-full bg-blue-200 flex items-center justify-center text-blue-700 font-bold text-lg">AS</div>
                        <div>
                            <p class="font-bold text-gray-800 text-sm">Ananya Sharma</p>
                            <p class="text-xs text-gray-500">Student ‚Ä¢ 16y</p>
                        </div>
                    </div>
                </div>
                <nav class="flex-grow p-4 space-y-2">
                    <button onclick="switchDashView('chat')" class="w-full text-left px-4 py-3 rounded-lg bg-white border border-gray-200 shadow-sm text-gray-700 font-medium hover:bg-blue-50 hover:border-blue-200 transition-colors flex items-center">
                        <span class="mr-3">üí¨</span> Ask Symptom
                    </button>
                    <button onclick="switchDashView('stats')" class="w-full text-left px-4 py-3 rounded-lg text-gray-600 hover:bg-gray-100 transition-colors flex items-center">
                        <span class="mr-3">üìä</span> My Health Stats
                    </button>
                    <button onclick="switchDashView('resources')" class="w-full text-left px-4 py-3 rounded-lg text-gray-600 hover:bg-gray-100 transition-colors flex items-center">
                        <span class="mr-3">üìö</span> Resources
                    </button>
                </nav>
                <div class="p-4 bg-orange-50 m-4 rounded-lg">
                    <p class="text-xs text-orange-800 font-bold mb-1">Emergency?</p>
                    <p class="text-xs text-orange-700">Call 1800-1200-1200</p>
                </div>
            </aside>

            <!-- Dashboard Content -->
            <div class="flex-grow flex flex-col relative overflow-hidden bg-white">
                
                <!-- DASH VIEW: CHAT -->
                <div id="dash-chat" class="flex flex-col h-full">
                    <header class="h-16 border-b border-gray-100 flex items-center justify-between px-6 bg-white shrink-0">
                        <h3 class="font-bold text-gray-800">Health Assistant</h3>
                        <span class="px-2 py-1 bg-blue-100 text-blue-700 text-xs rounded-full">‚óè Online</span>
                    </header>
                    
                    <!-- Chat Area -->
                    <div id="chat-messages" class="flex-grow p-6 overflow-y-auto space-y-4 bg-gray-50 chat-scroll">
                        <!-- Welcome Message -->
                        <div class="flex items-start">
                            <div class="w-8 h-8 rounded-full bg-blue-600 flex items-center justify-center text-white text-xs mr-3 flex-shrink-0">Bot</div>
                            <div class="bg-white p-4 rounded-2xl rounded-tl-none shadow-sm border border-gray-100 max-w-[80%]">
                                <p class="text-sm text-gray-700">Hello Ananya! üëã I'm your health assistant. Feel free to ask things like:</p>
                                <ul class="mt-2 text-xs text-gray-500 space-y-1">
                                    <li class="cursor-pointer hover:text-blue-600" onclick="sendPrompt(this.innerText)">‚Ä¢ Is it normal to have acne?</li>
                                    <li class="cursor-pointer hover:text-blue-600" onclick="sendPrompt(this.innerText)">‚Ä¢ How much sleep do I need?</li>
                                    <li class="cursor-pointer hover:text-blue-600" onclick="sendPrompt(this.innerText)">‚Ä¢ Why do I feel tired after lunch?</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <!-- Input Area -->
                    <div class="p-4 bg-white border-t border-gray-100">
                        <form onsubmit="handleChatSubmit(event)" class="flex space-x-2">
                            <input type="text" id="chat-input" class="flex-grow px-4 py-3 rounded-full border border-gray-300 focus:outline-none focus:border-blue-500 bg-gray-50" placeholder="Type your health question...">
                            <button type="submit" class="w-12 h-12 rounded-full bg-blue-600 text-white flex items-center justify-center hover:bg-blue-700 shadow-md">
                                ‚û§
                            </button>
                        </form>
                    </div>
                </div>

                <!-- DASH VIEW: STATS -->
                <div id="dash-stats" class="hidden h-full overflow-y-auto p-6 bg-gray-50">
                    <h3 class="text-2xl font-bold text-gray-800 mb-2">Health Insights</h3>
                    <p class="text-sm text-gray-500 mb-6">Visualizing common trends and your personal wellness check-ins.</p>

                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        
                        <!-- Chart 1: Common Concerns -->
                        <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100">
                            <div class="mb-4">
                                <h4 class="font-bold text-gray-800">You Are Not Alone</h4>
                                <p class="text-xs text-gray-500">Percentage of students reporting these issues (Source Report Data).</p>
                            </div>
                            <div class="chart-container">
                                <canvas id="concernsChart"></canvas>
                            </div>
                            <div class="mt-4 p-3 bg-blue-50 rounded border border-blue-100">
                                <p class="text-xs text-blue-800"><strong>Insight:</strong> 87% of teenagers develop acne. It is completely normal and linked to hormonal changes during puberty.</p>
                            </div>
                        </div>

                        <!-- Chart 2: Wellness Radar -->
                        <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100">
                            <div class="mb-4">
                                <h4 class="font-bold text-gray-800">Your Wellness Balance</h4>
                                <p class="text-xs text-gray-500">Based on your recent check-in answers.</p>
                            </div>
                            <div class="chart-container">
                                <canvas id="radarChart"></canvas>
                            </div>
                            <div class="mt-4 text-center">
                                <button class="text-xs text-blue-600 font-semibold hover:underline">Update Daily Check-in</button>
                            </div>
                        </div>

                    </div>
                </div>
                 <!-- DASH VIEW: RESOURCES -->
                <div id="dash-resources" class="hidden h-full overflow-y-auto p-6 bg-gray-50">
                    <h3 class="text-2xl font-bold text-gray-800 mb-6">Health Library</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="bg-white p-4 rounded-lg shadow-sm border-l-4 border-blue-500">
                            <h4 class="font-bold text-gray-800">Mental Health</h4>
                            <p class="text-sm text-gray-600 mt-1">Stress management, anxiety, and finding balance.</p>
                        </div>
                        <div class="bg-white p-4 rounded-lg shadow-sm border-l-4 border-green-500">
                            <h4 class="font-bold text-gray-800">Nutrition & Diet</h4>
                            <p class="text-sm text-gray-600 mt-1">Healthy eating habits for students.</p>
                        </div>
                         <div class="bg-white p-4 rounded-lg shadow-sm border-l-4 border-purple-500">
                            <h4 class="font-bold text-gray-800">Sleep Hygiene</h4>
                            <p class="text-sm text-gray-600 mt-1">Why 8 hours matters and how to get it.</p>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </main>

    <script>
        // --- State Management ---
        const state = {
            view: 'login', // login, register, otp, success, dashboard
            formData: {},
            generatedPassword: '',
            isLoggedIn: false
        };

        // --- DOM Elements ---
        const views = {
            login: document.getElementById('view-login'),
            register: document.getElementById('view-register'),
            otp: document.getElementById('view-otp'),
            success: document.getElementById('view-success')
        };
        const tabs = {
            login: document.getElementById('tab-login'),
            register: document.getElementById('tab-register')
        };
        const containers = {
            auth: document.getElementById('auth-container'),
            dashboard: document.getElementById('dashboard-container')
        };

        // --- Navigation Logic ---
        function switchTab(tabName) {
            // Update Tab Styles
            Object.keys(tabs).forEach(t => {
                if(t === tabName) {
                    tabs[t].classList.add('tab-active');
                    tabs[t].classList.remove('tab-inactive');
                } else {
                    tabs[t].classList.remove('tab-active');
                    tabs[t].classList.add('tab-inactive');
                }
            });

            // Update View Visibility
            Object.keys(views).forEach(v => views[v].classList.add('hidden'));
            
            if(tabName === 'register') {
                // Reset register flow to start
                views['register'].classList.remove('hidden');
                views['register'].classList.add('fade-in');
            } else {
                views[tabName].classList.remove('hidden');
                views[tabName].classList.add('fade-in');
            }
        }

        // --- Register Flow Logic ---
        function syncAge(val) {
            document.getElementById('reg-age-slider').value = val;
            document.getElementById('age-display').innerText = val;
            document.getElementById('reg-age').value = val;
            
            const warning = document.getElementById('age-warning');
            if(val < 18) {
                warning.classList.remove('hidden');
                warning.innerText = "üì¢ You are under 18. Talk to a parent about concerns.";
            } else {
                warning.classList.add('hidden');
            }
        }

         function calculateAgeFromDOB(dobString) {
            if(!dobString) return;
            const dob = new Date(dobString);
            const today = new Date();
            let age = today.getFullYear() - dob.getFullYear();
            const m = today.getMonth() - dob.getMonth();
            if (m < 0 || (m === 0 && today.getDate() < dob.getDate())) {
                age--;
            }
            
            // Clamp age to slider limits (10-25) for this specific UI
            let sliderVal = age;
            if (age < 10) sliderVal = 10;
            if (age > 25) sliderVal = 25;

            // Update slider visual
            syncAge(sliderVal);
        }

        function validateField(input) {
            const feedback = document.getElementById('name-feedback');
            if(input.value.length > 2) {
                feedback.classList.remove('hidden');
            } else {
                feedback.classList.add('hidden');
            }
        }

        function updateCharCount(textarea) {
            document.getElementById('char-count').innerText = textarea.value.length;
        }

        function initiateOtp(e) {
            e.preventDefault();
            
            // Collect Data
            state.formData = {
                name: document.getElementById('reg-name').value,
                email: document.getElementById('reg-email').value,
                age: document.getElementById('reg-age').value,
                dob: document.getElementById('reg-dob').value,
                region: document.getElementById('reg-region').value,
                chronic: document.getElementById('reg-chronic').value,
                allergies: document.getElementById('reg-allergies').value,
                medications: document.getElementById('reg-medications').value,
                surgeries: document.getElementById('reg-surgeries').value
            };

            // Switch to OTP View
            views.register.classList.add('hidden');
            views.otp.classList.remove('hidden');
            document.getElementById('otp-email-display').innerText = state.formData.email;
            
            // Focus first OTP input
            setTimeout(() => {
                document.querySelector('.otp-input').focus();
            }, 100);
        }

        function focusNext(el, index) {
            if (el.value.length === 1) {
                const inputs = document.querySelectorAll('.otp-input');
                if (index < 3) {
                    inputs[index + 1].focus();
                }
            }
        }

        function verifyOtp() {
            const inputs = document.querySelectorAll('.otp-input');
            let otp = '';
            inputs.forEach(i => otp += i.value);

            if(otp.length === 4) {
                // Simulate verification delay
                const btn = document.querySelector('#view-otp button');
                const originalText = btn.innerText;
                btn.innerText = "Verifying...";
                
                setTimeout(() => {
                    // Success
                    views.otp.classList.add('hidden');
                    views.success.classList.remove('hidden');
                    
                    // Generate Dummy Password
                    state.generatedPassword = Math.random().toString(36).slice(-12);
                    document.getElementById('generated-password').innerText = "‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢";
                }, 1000);
            } else {
                alert("Please enter a 4-digit code (Any digits work for demo)");
            }
        }

        // --- Password Handling ---
        function togglePasswordVisibility() {
            const el = document.getElementById('generated-password');
            const btn = event.target;
            if (el.innerText === "‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢") {
                el.innerText = state.generatedPassword;
                btn.innerText = "Hide";
            } else {
                el.innerText = "‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢";
                btn.innerText = "Show";
            }
        }

        function copyPassword() {
            navigator.clipboard.writeText(state.generatedPassword).then(() => {
                alert("Password copied to clipboard!");
            });
        }

        function completeRegistration() {
            switchTab('login');
            // Pre-fill login email
            document.getElementById('login-email').value = state.formData.email;
            // Focus password
            setTimeout(() => document.getElementById('login-password').focus(), 500);
        }

        function handleLogin(e) {
    e.preventDefault();

    const btn = document.querySelector('#view-login button[type="submit"]');
    btn.innerText = "Logging in...";

    setTimeout(() => {
        // OPTIONAL: store user info for next page
        localStorage.setItem("username", state.formData.name || "Student");

        // Redirect to main page
        window.location.href = "MAINPAGE.html";
    }, 1000);
}


        function logout() {
            location.reload();
        }

        // --- Dashboard Navigation ---
        function switchDashView(viewName) {
            const dashViews = ['chat', 'stats', 'resources'];
            dashViews.forEach(v => {
                document.getElementById(`dash-${v}`).classList.add('hidden');
            });
            document.getElementById(`dash-${viewName}`).classList.remove('hidden');
            document.getElementById(`dash-${viewName}`).classList.add('fade-in');
        }

        // --- Chat Bot Logic ---
        function sendPrompt(text) {
            const input = document.getElementById('chat-input');
            input.value = text.replace('‚Ä¢ ', ''); // Remove bullet if clicked from list
            // trigger submit
            handleChatSubmit({ preventDefault: () => {} });
        }

        function handleChatSubmit(e) {
            e.preventDefault();
            const input = document.getElementById('chat-input');
            const msg = input.value.trim();
            if(!msg) return;

            // 1. Add User Message
            addMessage(msg, 'user');
            input.value = '';

            // 2. Simulate Bot Typing/Response
            const chatBox = document.getElementById('chat-messages');
            
            setTimeout(() => {
                let response = "I understand you're concerned. While I can't give medical advice, that sounds common.";
                
                // Simple logic based on Source Report content
                const lowerMsg = msg.toLowerCase();
                if(lowerMsg.includes('acne') || lowerMsg.includes('pimple')) {
                    response = "Based on student health data, **87% of teenagers develop acne**. It is usually caused by hormonal changes. Keep your face clean, but don't scrub too hard!";
                } else if (lowerMsg.includes('sleep') || lowerMsg.includes('tired')) {
                    response = "Teenagers typically need **8-10 hours of sleep**. Feeling tired after lunch is often due to circadian rhythms or blood sugar changes.";
                } else if (lowerMsg.includes('stress') || lowerMsg.includes('anxiety')) {
                    response = "School stress is real. Try the '4-7-8' breathing technique: Inhale for 4s, hold for 7s, exhale for 8s. If it feels overwhelming, please talk to a counselor.";
                }

                addMessage(response, 'bot');
            }, 800);
        }

        function addMessage(text, sender) {
            const chatBox = document.getElementById('chat-messages');
            const div = document.createElement('div');
            div.className = "flex items-start " + (sender === 'user' ? "justify-end" : "");
            
            let html = '';
            if(sender === 'bot') {
                html = `
                    <div class="w-8 h-8 rounded-full bg-blue-600 flex items-center justify-center text-white text-xs mr-3 flex-shrink-0">Bot</div>
                    <div class="bg-white p-4 rounded-2xl rounded-tl-none shadow-sm border border-gray-100 max-w-[80%] text-sm text-gray-700">
                        ${text.replace(/\*\*(.*?)\*\*/g, '<b>$1</b>')}
                    </div>
                `;
            } else {
                html = `
                    <div class="bg-blue-600 p-4 rounded-2xl rounded-tr-none shadow-sm text-white max-w-[80%] text-sm">
                        ${text}
                    </div>
                `;
            }
            
            div.innerHTML = html;
            chatBox.appendChild(div);
            chatBox.scrollTop = chatBox.scrollHeight;
        }

        // --- Visualization (Chart.js) ---
        function initCharts() {
            // Chart 1: Common Concerns (Derived from "87% acne" in Source)
            // THEME UPDATE: Switched colors to Blue palette
            const ctx1 = document.getElementById('concernsChart').getContext('2d');
            new Chart(ctx1, {
                type: 'bar',
                data: {
                    labels: ['Acne', 'Sleep Issues', 'Stress', 'Vision', 'Allergies'],
                    datasets: [{
                        label: '% of Students',
                        data: [87, 65, 70, 40, 25],
                        backgroundColor: [
                            'rgba(37, 99, 235, 0.8)', // Blue-600
                            'rgba(96, 165, 250, 0.6)', // Blue-400
                            'rgba(96, 165, 250, 0.6)',
                            'rgba(96, 165, 250, 0.6)',
                            'rgba(96, 165, 250, 0.6)'
                        ],
                        borderRadius: 5
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        tooltip: { 
                            callbacks: {
                                label: function(context) {
                                    return context.raw + '% of students report this';
                                }
                            }
                        }
                    },
                    scales: {
                        y: { beginAtZero: true, max: 100 }
                    }
                }
            });

            // Chart 2: Radar Wellness (Dummy User Data)
            // THEME UPDATE: Blue is standard for this already, ensuring consistency
            const ctx2 = document.getElementById('radarChart').getContext('2d');
            new Chart(ctx2, {
                type: 'radar',
                data: {
                    labels: ['Sleep', 'Hydration', 'Mood', 'Activity', 'Nutrition'],
                    datasets: [{
                        label: 'This Week',
                        data: [7, 5, 8, 4, 6],
                        fill: true,
                        backgroundColor: 'rgba(37, 99, 235, 0.2)', // Blue-600 low opacity
                        borderColor: '#2563EB', // Blue-600
                        pointBackgroundColor: '#2563EB',
                        pointBorderColor: '#fff',
                        pointHoverBackgroundColor: '#fff',
                        pointHoverBorderColor: '#2563EB'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    elements: {
                        line: { borderWidth: 3 }
                    },
                    scales: {
                        r: {
                            angleLines: { display: false },
                            suggestedMin: 0,
                            suggestedMax: 10
                        }
                    }
                }
            });
        }

        // Initialize Slider Value
        syncAge(16);
    </script>
</body>
</html>